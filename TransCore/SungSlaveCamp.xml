<?xml version="1.0" encoding="utf-8"?>

<TranscendenceModule>

<!-- STATION TYPES -->

	<!-- Level 4: Sung Slave Camp -->

	<StationType UNID="&stSungSlaveCamp;"
			name=				"Sung slave camp"
			sovereign=			"&svSung;"
			abandonedScreen=	"&dsAbandonedStation;"
			dockingPorts=		"8"
			canAttack=			"true"

			multiHull=			"true"
			armorID=			"&itSungArmor;"
			hitPoints=			"150"
			regen=				"4"
			fireRateAdj=		"80"
			ejectaType=			"&vtWreckEjecta;"

			attributes=			"enemy, envAir, envEarth, envFire, envWater, generic, human, populated, sungSlaveCamp, sungSlavers"
			levelFrequency=		"--vcu r---- ----- ----- -----"
			locationCriteria=	"+planetary"
			enemyExclusionRadius="60"
			>

		<Image			imageID="&rsStations4;" imageX="0" imageY="192" imageWidth="128" imageHeight="128"/>

		<Devices>
			<Device deviceID="&itParticleBeamWeapon;"	omnidirectional="true"/>
		</Devices>

		<Ships>
			<Ship		count="1d3+1"	class="&scWindSlaver;" orders="patrol" patrolDist="20"/>
		</Ships>

		<Items>
			<Lookup					count="1d4"	table="&trStationSupplies;" />
			<Table>
				<Lookup chance="40" count="1" table="&trConsumables5;"/>
				<Lookup chance="40" count="1" table="&trMinorItem5;"/>
				<Lookup chance="20" count="1" table="&trMajorItem5;"/>
			</Table>
		</Items>

		<Encounters frequency="common">
			<Ship   count="1d4"	class="&scWindSlaver;" orders="attack"/>
		</Encounters>

		<Satellites overlapCheck="asteroids">
			<Orbitals count="6" distance="8" angle="equidistant">
				<Station type="&stSungDefenseSat1;"/>
			</Orbitals>

			<Orbitals count="3d2" distance="3" angle="equidistant">
				<Station type="&stSungSlaveQuarters1;"/>
			</Orbitals>

			<Orbitals count="4d2" distance="5" angle="equidistant">
				<Table>
					<Station chance="50" type="&stSungSlaveQuarters1;"/>
					<Station chance="50" type="&stSungSlaveQuarters2;"/>
				</Table>
			</Orbitals>

			<Orbitals count="5d2" distance="7" angle="random">
				<Station type="&stSungSlaveQuarters2;"/>
			</Orbitals>

		</Satellites>

		<InitialData>
			<sung>True</sung>
		</InitialData>

		<Events>
			<OnCreate>
				; Count the number of slave quarters in the area
				(objSetData gSource "totalSlaveCount" 
					(count (sysFindObject gSource "T:sungSlaveQuarters; N:8;"))
					)
			</OnCreate>

			<GetRumors>
				{
					attributes: "commonwealthPub"
					priority: 41
					textID: 'rumor.commonwealthPub
					}
			</GetRumors>
		</Events>

		<Language>
			<Text id="rumor.commonwealthPub">
				You spend 5 credits while listening to a drunk woman:

				"My sister-in-law was abducted by those filthy Sung. We finally
				got her released by buying her contract. I can't believe they
				allow slavery to exist. Hey, can you buy me a drink?"
			</Text>
		</Language>
	</StationType>

	<!-- Sung Slave Quarters -->

	<StationType UNID="&stSungSlaveQuarters1;"
			name=				"Sung slave quarters|Sung slave quarters"
			sovereign=			"&svSungSlaves;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockScreen=			"&dsSungSlaveQuarters;"
			noMapLabel=			"true"

			armorID=			"&itUltraLightTitaniumArmor;"
			hitPoints=			"35"
			structuralHitPoints="10"
			ejectaType=			"&vtWreckEjecta;"
			mass=				"3000"

			attributes=			"sungSlaveQuarters"
			>

		<ImageVariants>
			<Image			imageID="&rsStations4;" imageX="192" imageY="32" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="192" imageY="64" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="192" imageY="96" imageWidth="32" imageHeight="32"/>
		</ImageVariants>

		<Language>
			<Text id="core.abandonedStationDesc">

				You are docked at a ruined structure once housing slaves.
				Lifeless forms float around in zero-G amid the scraps and mementos they once owned.

			</Text>
		</Language>

		<InitialData>
			<sungSlave>True</sungSlave>
		</InitialData>

		<DockingPorts
				portCount=		"2"
				portRadius=		"24"
				maxDist=		"3"
				/>

	</StationType>

	<!-- Sung Slave Quarters -->

	<StationType UNID="&stSungSlaveQuarters2;"
			name=				"Sung slave quarters|Sung slave quarters"
			sovereign=			"&svSungSlaves;"
			abandonedScreen=	"&dsRPGAbandonedStation;"
			dockScreen=			"&dsSungSlaveQuarters;"
			noMapLabel=			"true"

			armorID=			"&itUltraLightTitaniumArmor;"
			hitPoints=			"20"
			structuralHitPoints="10"
			ejectaType=			"&vtWreckEjecta;"
			mass=				"3000"

			attributes=			"sungSlaveQuarters"
			>

		<ImageVariants>
			<Image			imageID="&rsStations4;" imageX="224" imageY="0"  imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="224" imageY="32" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="224" imageY="64" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="224" imageY="96" imageWidth="32" imageHeight="32"/>
		</ImageVariants>

		<Language>
			<Text id="core.abandonedStationDesc">

				You are docked at a ruined structure once housing slaves.
				Lifeless forms float around in zero-G amid the scraps and mementos they once owned.

			</Text>
		</Language>

		<InitialData>
			<sungSlave>True</sungSlave>
		</InitialData>

		<DockingPorts
				portCount=		"2"
				portRadius=		"24"
				maxDist=		"3"
				/>

	</StationType>

<!-- ITEM TYPES -->

	<!-- Slave Coffin -->

	<ItemType UNID="&itSlaveCoffin;"
			name=				"slave coffin"
			level=				"5"
			value=				"2500"
			mass=				"500"
			frequency=			"rare"
			numberAppearing=	"1d3"
			attributes=			"Illegal; MinorItem; Slaves; Soul"

			description=		"The Sung Slavers of Jiang's Star transport their slaves in life-support canisters that keep their captive occupants in biological suspension."
			>

		<Image imageID="&rsItems1;" imageX="288" imageY="0" imageWidth="96" imageHeight="96"/>
	</ItemType>

<!-- DOCK SCREENS -->

	<!-- Sung Slave Quarters -->

	<DockScreen UNID="&dsSungSlaveQuarters;">

		<InitialPane>
			(block Nil
				; Look for the sung slaver
				(setq gSlaver (sysFindObject gSource "T:sungSlaveCamp; N"))
				(if gSlaver
					(switch
						; If the slaver has not been destroyed, then we're not free
						(not (objIsAbandoned gSlaver))
							"NotFree"

						; If we have a reward, then the slaver quarters are empty
						(eq (objGetData gSlaver "sungState") "done")
							"Empty"

						; If we have just taken some coffins, then we're done
						(eq (objGetData gSlaver "sungState") "coffins")
							"Done"

						; Otherwise, the player may or may not get a reward
						(block (slaves alive dead)
							; Get all the slave quarters
							(setq slaves (sysFindObject gSlaver "T:sungSlaveQuarters; N:8;"))

							; Count how many are still alive
							(setq alive 1)
							(enum slaves obj
								(if (not (objIsAbandoned obj))
									(setq alive (add alive 1))
									)
								)

							; The dead are the total minus the living
							(setq dead (subtract (objGetData gSlaver "totalSlaveCount") alive))

							; If there are more dead than alive then the player gets
							; nothing.
							(if (gr dead alive)
								"NoReward"
								"Default"
								)
							)
						)

					; No slaver found
					"Empty"
					)
				)
		</InitialPane>

		<Panes>
			<Default descID="descWelcome">
				<Actions>
					<Action name="Continue" cancel="1" default="1" key="C">
						(block Nil
							(objSetData gSlaver "sungState" "coffins")
							(objAddItem gSource (itmCreate &itSlaveCoffin; (random 1 12)))
							(scrShowScreen gScreen &dsRPGLoot; {
								nextScreen: &dsSungSlaveQuarters;
								})
							)
					</Action>
				</Actions>

			</Default>

			<Done descID="descDone">
				<Actions>
					<Action name="Undock" cancel="1" key="U">
						(block Nil
							(objSetData gSlaver "sungState" "done")
							(scrExitDock gScreen)
							)
					</Action>
				</Actions>
			</Done>

			<Empty descID="descEmpty">
				<Actions>
					<Action name="Undock" cancel="1" key="U">
						<Exit/>
					</Action>
				</Actions>
			</Empty>

			<NoReward descID="descNoReward">
				<Actions>
					<Action name="Undock" cancel="1" key="U">
						(block Nil
							(objSetData gSlaver "sungState" "done")
							(scrExitDock gScreen)
							)
					</Action>
				</Actions>
			</NoReward>

			<NotFree descID="descNotFree">
				<Actions>
					<Action name="Undock" cancel="1" key="U">
						<Exit/>
					</Action>
				</Actions>
			</NotFree>
		</Panes>

		<Language>
			<Text id="descWelcome">

				As you enter the station you are surrounded by cheering families:
				
				"Thank you for freeing us! The Slavers are finally dead! But 
				some of our people are still not liberated. Please take them to 
				a place where they can be free."

			</Text>
			<Text id="descDone">

				"Thank you again for saving us! We will never forget you."

			</Text>
			<Text id="descEmpty">

				You are docked at a station once used to house slaves of the 
				Sung Empire. Now abandoned, these living quarters appear no 
				worse than sub-standard corporate quarters.
				
				But a closer look reveals surveillance sensors and discarded 
				docility collars.

			</Text>
			<Text id="descNoReward">

				You are docked at the living quarters of a small slave community. 
				Though free at last, they weep for the hundreds who died in the 
				attack and for the family that the dead have left behind. 
				
				The piercing wail of the inconsolable does not completely mask 
				the anger of those looking for revenge.
				
				You are not welcome here.

			</Text>
			<Text id="descNotFree">

				You are docked at a station used to house slaves. Two men meet 
				you at the airlock:
				
				"Get out of here! Leave while you can before the Slavers return!"

			</Text>
		</Language>
	</DockScreen>

</TranscendenceModule>
